@{
    ViewBag.Title = "Skapa restaurang manuellt";
}
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&libraries=places"></script>
<script src='//api.tiles.mapbox.com/mapbox.js/v1.3.1/mapbox.js'></script>
<link href='//api.tiles.mapbox.com/mapbox.js/v1.3.1/mapbox.css' rel='stylesheet' />
<!--[if lte IE 8]>
    <link href='//api.tiles.mapbox.com/mapbox.js/v1.3.1/mapbox.ie.css' rel='stylesheet' >
  <![endif]-->

<h2>Lägg till en restaurang manuellt</h2>

<hr />
<h3 class="grey">1. Allmänt</h3>
<form method="POST" action="/Manage/CreateEnterprise">
    <div class="col12">
        <label>Namn</label>
        <input type="text" name="name" required />

        <label>Telefon</label>
        <input type="text" name="phone" required />

        <label>Kategorier</label>
        <div id="chosen-categories"></div>
        <select id="category">
            <option></option>
            @foreach (var category in ViewBag.Categories)
            {
                <option value="@category.Value">@category.Text</option>    
            }
        </select>

        <hr />
        <h3 class="grey">2. Plats <span data-icon="&#xe003;"></span></h3>
        <div class="marginB20 row">
            <label>Adress</label>
            <input type="text" name="address" id="address" class="input-xlarge pull-left">
            <a id="map-check" class="btn btn-success marginL5">Hämta övrig info</a>

        </div>

            <div id="general-location-info"></div>

    </div>
    <div class="col12">
        <input type="submit" value="Spara" class="btn btn-success btn-large" />
    </div>
</form>
<script src="~/Scripts/jquery.validate.min.js"></script>

<script>
    $("form").validate({
        rules: {
            postalCode: {
                number: true
            }
        },
        submitHandler: function (form) {
            var chosenCategoriesCount = $("#chosen-categories").children('div').size();
            if (chosenCategoriesCount == 0) {
                $("<b class='red'>Välj minst 1 kategori!</b>").insertAfter("#chosen-categories");
            }
            else {
                form.submit();
            }
        }
    });

    $("#category").change(function () {
        var value = this.value;
        if (value != "") {
            var text = $('#category option:selected').html();
            var divChosenCategories = $("#chosen-categories");
            var count = divChosenCategories.children('div').size();

            if (count < 5) {
                divChosenCategories.append("<div><p class='inline'>" + text + "</p><input type='hidden' name='category" + count + "' value='" + value + "' />" +
                    "<i class='icon-remove'></i></div>");
                if (count == 4) {
                    $("#category").addClass("hide");
                }
            }
        }
    });
    $("#chosen-categories").on("click", ".icon-remove", function () {
        $(this).parent().remove();
        $("#category").removeClass("hide");
    });

    $(document).ready(function () {
        $(window).keydown(function (event) {
            if (event.keyCode == 13) {
                event.preventDefault();
                return false;
            }
        });
        $("#map-check").click(function () {

            $("#map").remove();
            $("<div id='map'></div>").appendTo("#map-container-validate");
            var map = $("#general-location-info");
            var address = $("#address").val();
            iMenyn.Ajax.RenderGeneralInfoByAddress(map, address);
        });
    });



    function initialize() {
        var address = (document.getElementById('address'));
        var addressOptions = {
            componentRestrictions: { country: 'se' }
        };
        var city = (document.getElementById('city'));
        var cityOptions = {
            types: ['(cities)'],
            componentRestrictions: { country: 'se' }
        };

        var autocompleteAddress = new google.maps.places.Autocomplete(address, addressOptions);
        var autocompleteCity = new google.maps.places.Autocomplete(city, cityOptions);
        //autocomplete.setComponentRestrictions({ "country": "se" });
        autocompleteAddress.setTypes(['geocode']);
        autocompleteCity.setTypes(['geocode']);
    }
    google.maps.event.addDomListener(window, 'load', initialize);
</script>



<noscript>
    <style>
        form {
            display: none;
        }
    </style>
    <h1>Aktivera JavaScript för att se sidan...</h1>
</noscript>
